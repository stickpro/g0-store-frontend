<script setup lang="ts">
import Slider from "~/components/home/Slider.vue";
import PopularProducts from "~/components/home/PopularProducts.vue";
import type {ShortProduct} from "~/repository/types/api/generatedApiGo";

const {$api} = useNuxtApp();
const config = useRuntimeConfig();

const popularProducts = ref<any[]>([]);
const loading = ref(true);

// Загрузка популярных товаров
async function loadPopularProducts() {
  loading.value = true;
  try {
    const collection = await $api.collection.getPopular();

    // Преобразуем товары коллекции в формат для компонента
    popularProducts.value = (collection.products || []).map((product: ShortProduct) => ({
      id: product.id,
      name: product.name,
      article: product.model,
      price: product.price || 0,
      image: product.image ? `${config.public.storageUrl}/${product.image}` : undefined,
      stock_status: product.is_enable ? 'in_stock' : 'out_of_stock'
    }));
  } catch (error) {
    console.error('Ошибка загрузки популярных товаров:', error);
  } finally {
    loading.value = false;
  }
}

function handleAddToCart(product: any) {
  console.log('Add to cart:', product);
  // Здесь будет логика добавления в корзину
}

// Загружаем товары при монтировании
onMounted(() => {
  loadPopularProducts();
});
</script>

<template>
  <div>
    <Slider/>
    <PopularProducts
        title="Популярные"
        :products="popularProducts"
        :loading="loading"
        @add-to-cart="handleAddToCart"
    />
    <div class="text-sm gap-6 grid  text-zinc-700">
      <p>Ноутбуки и планшеты – незаменимые гаджеты практически для каждого человека. Несмотря на то, что подобные
        устройства сегодня отличаются повышенной надежностью, даже они иногда выходят из строя. Чаще всего потеря
        работоспособности обусловлена поломкой электронных элементов.</p>
      <p>В этом случае потребуется установить новые детали и комплектующие. Однако при поиске нужных элементов нередко
        возникают проблемы: особенно, если модель Вашего гаджета является редкой. Мы можем предложить решение этой
        непростой проблемы – приобрести все требуемые детали Вы сможете в нашем интернет-магазине «3Delectronics.ru» в
        Санкт-Петербурге. Мы занимаемся продажей запчастей и комплектующих для ноутбуков, планшетов и телефонов.</p>
      <p class="text-xl">Ассортимент «3Delectronics.ru»</p>
      <p>Наш магазин уже более 8 лет занимается поставкой деталей для ноутбуков. За это время мы завоевали доверие у
        многих покупателей.</p>
      <p>Мы предлагаем различные типы чипов, микросхем, разъемов, матриц, клавиатур, зарядок и блоков питания для
        ноутбуков и планшетов. Также у нас представлен широкий выбор различных аксессуаров: автоадаптеров, внешних
        аккумуляторов, кабелей и переходников.</p>
      <p>Наши товары подойдут для гаджетов различных марок: Apple, Asus, Acer, HP, Lenovo, Sony, Samsung и др. В
        описании каждого товара представлены подробные характеристики и фото, благодаря чему Вы сможете самостоятельно
        подобрать комплектующие для своего ноутбука или планшета. А если у Вас возникнут вопросы, то наш менеджер всегда
        поможет с выбором.</p>
      <p class="text-xl">Почему стоит купить детали у нас?</p>
      <ul class="list-disc pl-6 space-y-2">
        <li>Мы обеспечиваем быструю и надежную доставку всех товаров, так как сотрудничаем с поставщиками напрямую.</li>
        <li>В каталоге представлены только оригинальные запчасти, которые отличаются высоким качеством и надежностью.
        </li>
        <li>На все изделия предоставляется гарантия сроком от 3 до 6 месяцев. При обнаружении брака мы обменяем товар
          или вернем Вам деньги.
        </li>
        <li>Оплата заказа может быть осуществлена любым удобным для Вас способом.</li>
        <li>Наш ассортимент постоянно пополняется новыми деталями и аксессуарами. Мы отслеживаем новые модели телефонов,
          планшетов и ноутбуков. Поэтому в нашем каталоге Вы непременно найдете комплектующие даже для недавно вышедшего
          гаджета.
        </li>
        <li>Для постоянных покупателей у нас действуют разнообразные скидки и акции.</li>
        <li>Если в нашем каталоге не найдется нужной детали, то мы поможем ее найти и организуем доставку.</li>
      </ul>
      <p>Низкие цены на комплектующие для ноутбуков и планшетов Мы уверены, что стоимость наших товаров непременно
        порадует Вас, ведь мы работаем с производителями напрямую. Это позволяет существенно снизить цены на все
        комплектующие.</p>
    </div>
  </div>
</template>

<style lang="css">

</style>
